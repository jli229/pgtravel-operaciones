$(document).ready(function(){$('input:radio[name="offer_form[clientType]"]').on("ifClicked",function(){var a=$(this).val();if(a==="direct"){$(".block-clienttype.block-clienttype-direct").show();$(".block-clienttype:not(.block-clienttype-direct)").find("input:text, select").each(function(){if($(this).data("tooltipster-ns")){$(this).tooltipster("hide")}});$(".block-clienttype:not(.block-clienttype-direct)").hide()}else{if(a==="registered"){$(".block-clienttype.block-clienttype-registered").show();$(".block-clienttype:not(.block-clienttype-registered)").find("input:text, select").each(function(){if($(this).data("tooltipster-ns")){$(this).tooltipster("hide")}});$(".block-clienttype:not(.block-clienttype-registered)").hide()}}});$("#offer_form_client").on("change",function(){$("#offer_form_notificationContact").empty();var a=$(this).val();$.getJSON(Routing.generate("app_offers_getclientcontacts")+"?client="+a,function(b){$("#offer_form_notificationContact").append($('<option value=""></option>'));$.each(b.elements,function(c,d){$("#offer_form_notificationContact").append($('<option value="'+d.id+'">'+d.text+"</option>"))})})});$("#offer_form_directClientMobilePhone").intlTelInput({allowExtensions:true,autoFormat:false,autoHideDialCode:true,autoPlaceholder:false,defaultCountry:"auto",geoIpLookup:function(a){$.get("http://ipinfo.io",function(){},"jsonp").always(function(c){var b=(c&&c.country)?c.country:"";a(b)})},nationalMode:false,numberType:"MOBILE",preferredCountries:["ca","us","gb"],utilsScript:phone_util_script_url});+(function(){var a=function(c){var b=$(c).find("input.datepicker");$(b[0]).parent().datetimepicker({format:"DD/MM/YYYY HH:mm"});$(b[1]).parent().datetimepicker({format:"D/MM/YYYY HH:mm",useCurrent:false});$(b[0]).parent().on("dp.change",function(d){$(b[1]).parent().data("DateTimePicker").minDate(d.date)});$(b[1]).parent().on("dp.change",function(d){$(b[0]).parent().data("DateTimePicker").maxDate(d.date)})};$(".item.item-service").each(function(){a(this)});$("body").on("click",".btn-add-item",function(e){var d=$(this);if(d.is("a")){e.preventDefault()}var f=$(d.data("collection")),c=f.data("index"),b=f.data("prototype");$counter=f.data("counter")?$(f.data("counter")):null;$item=$(b.replace(/__name__/g,c));f.data("index",c+1);if($counter){$counter.val(parseInt($counter.val(),10)+1)}f.append($item);a($item);$item.find("input:text:first").focus();if(f.closest("div.x_panel").find("h2").data("tooltipster-ns")){f.closest("div.x_panel").find("h2").tooltipster("hide")}$("body").animate({scrollTop:$item.offset().top},500)});$("body").on("click",".btn-remove-item",function(c){var b=$(this);if(b.is("a")){c.preventDefault()}b.closest(".item").fadeOut(function(){var e=$(this).closest(".collection"),d=e.data("counter")?$(e.data("counter")):null;$(this).remove();if(d){d.val(d.val()-1)}})})}());+(function(){$("#reservation").validate({errorPlacement:function(a,b){if(b.is(":hidden")){b=b.closest(":visible")}if(!b.data("tooltipster-ns")){b.tooltipster({trigger:"custom",onlyOne:false,position:"bottom-left",positionTracker:true})}b.tooltipster("update",$(a).text());b.tooltipster("show")},ignore:':hidden:not(input[name="servicesCounter"])',messages:{servicesCounter:{min:"Add a service at least"}},rules:{servicesCounter:{min:1},"offer_form[directClientFullName]":{required:{depends:function(){return $("#offer_form_clientType_1").prop("checked")===true}}},"offer_form[client]":{required:{depends:function(){return $("#offer_form_clientType_0").prop("checked")===true}}},"offer_form[percentApplied][plus]":"number"},success:function(b,c){var a=$(c);if(a.is(":hidden")){a=a.closest(":visible")}a.tooltipster("hide")}})}());+(function(){$("body").on("click",".btn-search-service",function(){var a=$(this).closest(".item");$("#searchServiceModal").data("item",a).modal({backdrop:"static"});$("#searchServiceModal .modal-body").empty().append($("<p>Cargando datos...</p>")).load(Routing.generate("app_offers_searchservice"))})}());+(function(d){var b=function(e){return isNaN(parseFloat(e))?0:parseFloat(e)};var a=function(){var e=new Number(0);d('.item-service input[name$="[supplierPrice]"]').each(function(){e+=b(d(this).val())});d("#offer_form_totalExpenses").val(e.toFixed(2)).trigger("change")};d("#offer_form_services").on("change",'.item-service input[name$="[supplierPrice]"]',function(){a()});d(".item-administrative-charge").on("change","input",function(){if(!d(this).is('[name$="[pax]"], [name$="[nights]"], [name$="[price]"]')){return}var e=new Number();d(this).closest(".item").find('[name$="[pax]"], [name$="[nights]"]').each(function(){e+=b(d(this).val())*b(d(this).closest(".item").find('input[name$="[price]"]').val())});d(this).closest(".item").find('input[name$="[total]"]').val(e.toFixed(2)).trigger("change")});var c=function(){var e=d("#offer_form_totalCharges"),g=d('.item-administrative-charge input[name$="[total]"]'),f=new Number(0);g.each(function(){f+=b(d(this).val())});e.val(f.toFixed(2)).trigger("change")};d(".item-administrative-charge").on("change",'input[name$="[total]"]',function(){c()});d("#offer_form_totalExpenses, #offer_form_totalCharges, #offer_form_percentApplied_percent, #offer_form_percentApplied_plus").on("change",function(){var e=d("#offer_form_totalExpenses, #offer_form_totalCharges, #offer_form_percentApplied_percent, #offer_form_percentApplied_plus");var h=b(d("#offer_form_totalExpenses").val()),f=b(d("#offer_form_totalCharges").val()),i=d("#offer_form_percentApplied_percent"),g;if(i.val()==="plus"){g=new Number(h+f+b(d("#offer_form_percentApplied_plus").val()))}else{g=new Number(h*(i.val()/100)+h+f)}d("#offer_form_clientCharge").val(g.toFixed(2))});d("#offer_form_totalExpenses").trigger("change");d("#offer_form_percentApplied_percent").on("change",function(){if(d(this).val()!=="plus"){d("#offer_form_percentApplied_plus").val(0)}});a();c()}(jQuery))});